
<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Gerador de Countdown Dinâmico</title>
<style>
  body { font-family: Arial, sans-serif; background:#f4f4f4; margin:0; padding:24px; color:#222; }
  .container { max-width:760px; margin:0 auto; background:#fff; border-radius:12px; box-shadow:0 8px 20px rgba(0,0,0,.06); padding:24px; }
  h1 { margin-bottom:16px; font-size:22px; text-align:center; }
  .form-group { margin-bottom:16px; }
  label { display:block; font-weight:600; margin-bottom:8px; }
  input[type="datetime-local"], input[type="color"] {
    width:100%; padding:10px; border:1px solid #ccc; border-radius:8px;
  }
  button { width:100%; padding:12px; border:none; border-radius:8px; font-weight:700; cursor:pointer; }
  #generate { background:#007bff; color:#fff; }
  #generate:hover { background:#0067d6; }
  .preview img { max-width:100%; border-radius:8px; margin-top:16px; }
  .live-counter { font-size:24px; font-weight:bold; margin-top:10px; color:#007bff; }
  textarea {
    width:100%; min-height:100px; padding:12px; border:1px solid #ccc; border-radius:8px;
    font-family: monospace; font-size:13px; color:#222;
  }
  .actions { display:flex; gap:10px; margin-top:10px; }
  .actions button { flex:1; background:#007bff; color:#fff; }
</style>
</head>
<body>
<div class="container">
  <h1>Gerador de Countdown Dinâmico</h1>

  <div class="form-group">
    <label for="end">Data limite:</label>
    <input type="datetime-local" id="end">
  </div>
  <div class="form-group">
    <label for="bg">Cor de fundo:</label>
    <input type="color" id="bg" value="#000000">
  </div>
  <div class="form-group">
    <label for="digit">Cor dos números:</label>
    <input type="color" id="digit" value="#FFFFFF">
  </div>
  <div class="form-group">
    <label for="box">Cor das caixas:</label>
    <input type="color" id="box" value="#1E1E1E">
  </div>

  <button id="generate">Gerar Countdown</button>

  <div class="preview" id="preview"></div>
  <div class="live-counter" id="liveCounter"></div>

  <textarea id="code" readonly></textarea>
  <div class="actions">
    <button id="copy">Copiar código</button>
    <button id="reset">Limpar</button>
  </div>
</div>

<script>
(function(){
  const endInput = document.getElementById('end');
  const bgInput = document.getElementById('bg');
  const digitInput = document.getElementById('digit');
  const boxInput = document.getElementById('box');
  const previewDiv = document.getElementById('preview');
  const liveCounter = document.getElementById('liveCounter');
  const codeTa = document.getElementById('code');
  const genBtn = document.getElementById('generate');
  const copyBtn = document.getElementById('copy');
  const resetBtn = document.getElementById('reset');

  let countdownInterval;

  function toIsoLocal(dt){
    const pad = n => String(n).padStart(2,'0');
    return `${dt.getFullYear()}-${pad(dt.getMonth()+1)}-${pad(dt.getDate())}T${pad(dt.getHours())}:${pad(dt.getMinutes())}`;
  }
  const init = new Date(Date.now() + 3*24*3600*1000);
  endInput.value = toIsoLocal(init);

  function buildUrl(){
    const end = endInput.value;
    if(!end){ throw new Error('Informe a data limite.'); }
    const bg    = encodeURIComponent(bgInput.value);
    const digit = encodeURIComponent(digitInput.value);
    const box   = encodeURIComponent(boxInput.value);
    const base  = window.location.origin;
    return `${base}/countdown-image?end=${end}&bg=${bg}&digit=${digit}&box=${box}`;
  }

  function startLiveCountdown(endDate){
    clearInterval(countdownInterval);
    function update(){
      const now = new Date().getTime();
      const diff = endDate - now;
      if(diff <= 0){
        liveCounter.textContent = "00:00:00:00";
        clearInterval(countdownInterval);
        return;
      }
      const days = Math.floor(diff / (1000*60*60*24));
      const hours = Math.floor((diff % (1000*60*60*24)) / (1000*60*60));
      const minutes = Math.floor((diff % (1000*60*60)) / (1000*60));
      const seconds = Math.floor((diff % (1000*60)) / 1000);
      liveCounter.textContent = `${String(days).padStart(2,'0')}:${String(hours).padStart(2,'0')}:${String(minutes).padStart(2,'0')}:${String(seconds).padStart(2,'0')}`;
    }
    update();
    countdownInterval = setInterval(update, 1000);
  }

  genBtn.addEventListener('click', () => {
    try{
      const url = buildUrl();
      const cacheBuster = `_t=${Date.now()}`;
      const finalUrl = `${url}&${cacheBuster}`;

      // Preview da imagem
      previewDiv.innerHTML = `${finalUrl}`;

      // Snippet para e-mail
      const code = `<table align="center"><tbody><tr><td>${finalUrl}</td></tr></tbody></table>`;
      codeTa.value = code;

      // Contador ao vivo
      const endDate = new Date(endInput.value).getTime();
      startLiveCountdown(endDate);
    }catch(err){
      alert(err.message || 'Erro ao gerar URL');
    }
  });

  copyBtn.addEventListener('click', async () => {
    try{
      await navigator.clipboard.writeText(codeTa.value);
      copyBtn.textContent = 'Copiado!';
      setTimeout(() => copyBtn.textContent = 'Copiar código', 1500);
    }catch{
      codeTa.select();
      document.execCommand('copy');
      copyBtn.textContent = 'Copiado!';
      setTimeout(() => copyBtn.textContent = 'Copiar código', 1500);
    }
  });

  resetBtn.addEventListener('click', () => {
    endInput.value = toIsoLocal(new Date(Date.now() + 3*24*3600*1000));
    bgInput.value = '#000000';
    digitInput.value = '#FFFFFF';
    boxInput.value = '#1E1E1E';
    previewDiv.innerHTML = '';
    liveCounter.textContent = '';
    codeTa.value = '';
    clearInterval(countdownInterval);
  });
})();
</script>
</body>
</html>
